<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ส่งข้อมูลไป Google Sheets (OCR)</title>
    <style>
      body{font-family:system-ui,Arial,sans-serif;max-width:820px;margin:24px auto;padding:0 16px}
      label{display:block;margin:10px 0 6px}
      input, textarea, select{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px}
      button{padding:10px 16px;border:0;border-radius:8px;cursor:pointer}
      .row{margin-bottom:14px}
      .ok{color:green} .err{color:#b30000} .muted{color:#666;font-size:12px}
      .inline{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
      video, canvas{width:100%;max-height:280px;border:1px solid #e5e5e5;border-radius:12px}
      .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eee;font-size:12px}
    </style>
  </head>
  <body>
    <h1>ส่งข้อมูลไป Google Sheets + OCR ตัวเลข (tesseract.js)</h1>

    <form id="messageForm" novalidate>
      <div class="row">
        <label for="name">Name *</label>
        <input id="name" name="name" required />
      </div>

      <div class="row">
        <label for="email">Email *</label>
        <input id="email" name="email" type="email" required />
      </div>

      <div class="row">
        <label for="message">Message *</label>
        <textarea id="message" name="message" rows="4" required></textarea>
      </div>

      <div class="row">
        <label for="status">Status</label>
        <select id="status" name="status">
          <option value="">(ไม่ระบุ)</option>
          <option value="new">new</option>
          <option value="pending">pending</option>
          <option value="done">done</option>
        </select>
      </div>

      <!-- ฟิลด์ที่จะรับค่าจาก OCR -->
      <div class="row">
        <label for="scanNumber">เลขที่สแกน (ตัดเป็นตัวเลขล้วน)*</label>
        <input id="scanNumber" name="scanNumber" placeholder="สแกนจากรูป/กล้อง หรือพิมพ์เอง" required />
        <div class="muted">ระบบจะใช้ OCR แล้วคัดเฉพาะ 0-9 ใส่ช่องนี้ให้อัตโนมัติ</div>
      </div>

      <!-- ส่วนสแกนด้วยรูป -->
      <div class="row">
        <label>สแกนจากรูปภาพ</label>
        <div class="inline">
          <input type="file" id="imgFile" accept="image/*" />
          <button type="button" id="btnOcrImage">สแกนจากรูป (OCR)</button>
          <span id="ocrStatus" class="badge">OCR: idle</span>
        </div>
      </div>

      <!-- ส่วนสแกนด้วยกล้อง -->
      <div class="row">
        <label>สแกนจากกล้อง</label>
        <div class="inline">
          <button type="button" id="btnOpenCam">เปิดกล้อง</button>
          <button type="button" id="btnCapture" disabled>จับภาพ + OCR</button>
          <button type="button" id="btnCloseCam" disabled>ปิดกล้อง</button>
        </div>
        <video id="video" playsinline style="display:none"></video>
        <canvas id="canvas" style="display:none"></canvas>
        <div id="camNote" class="muted">เปิดกล้อง → เล็งให้ชัด → กด “จับภาพ + OCR”</div>
      </div>

      <button id="submitBtn" type="submit">Send</button>
      <span id="result" style="margin-left:10px;"></span>
    </form>

    <!-- tesseract.js (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <!-- โค้ดหลักแยกไฟล์ -->
    <script src="./app.js"></script>
  </body>
</html>
